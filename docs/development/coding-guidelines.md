# コーディング規約 — 小分けモジュール化と開発手法

このドキュメントは本プロジェクト（neko_no_te）で採用する開発手法とコーディング規約の要点をまとめたものです。
特に「小分け（モジュール分割）」をプロジェクト方針として明記し、実装・レビュー・コミットの際に従ってください。

目的

- 可読性の向上
- レビューのしやすさ（差分が小さい）
- 再利用性と単体テストの容易さ
- CI 実行時間の短縮（小さな変更ごとのテスト）

基本方針

- 1 つの変更は「1 つの責務」に限定する。1機能＝1コミットを原則とする。
- ファイルは小さく保つ：1つのソースファイルは原則として単一の概念（例：1つのサブモジュール、1つの主要構造体、1つの責務）を担う。
- Rust のモジュールレイアウトは `src/<module>/mod.rs` と `src/<module>/<sub>.rs` のように分割する。トップレベルが大きくなりそうなら単一ファイルにしない。

モジュール分割のガイドライン

- 機能ごとにフォルダを作る（例：`src/plugins/`、`src/gui/`）。その中でさらに `discovery.rs`, `enabled.rs`, `metadata.rs` のように責務毎に分割する。
- 公開 API は `mod.rs`（もしくは `lib.rs`）でまとめて re-export する。内部の実装はプライベートまたは個別のサブモジュールとして切る。
- テストは可能な限りファイル単位で書く。サブモジュール毎に `#[cfg(test)] mod tests` を用意するか、`tests/` ディレクトリで統合テストを用意する。

命名規則

- ファイル名は snake_case、型は PascalCase。
- モジュール（フォルダ）名は機能名（例：`plugins`、`gui`）。サブモジュールはその責務を短く示す（例：`discovery`, `enabled`, `metadata`）。

コミットとレビュー

- 小さな差分でコミットする（機能追加・バグ修正・リファクタのいずれでも、できるだけ分割）。
- コミットメッセージは `type(scope): short description` 形式を推奨（例：`feat(plugins): add plugin.toml parsing`）。
- PR には必ず変更点の要約とテスト手順・影響範囲を記載する。

リファクタ時の注意

- リファクタであっても振る舞いが変わらないことを示すためにユニットテスト／統合テストを更新・追加する。
- 大きな構造変更は小さいステップに分けて PR を出す（例：1) API 抽出 2) 実装移行 3) 削除）。

Feature フラグとオプション依存

- CLI のように選択的にビルドする機能は `Cargo.toml` の features 機能で管理する。
- optional dependency を features に紐付け、デフォルトは軽量にする。

CI とドキュメント

- 重要な変更を加えたら `docs/` と `TESTS.md` を更新すること（CI が参照するため）。
- ドキュメントは日本語で記述する。短く明確に。

補足（例）

- 先に行った `neko-assistant` の `src/plugins` 分割はこの方針に従った例です：`metadata.rs`（型定義）、
 `discovery.rs`（発見ロジック）、`enabled.rs`（有効化ロジック）に分割し、`mod.rs` で公開 API を再エクスポートしています。

関連ファイル

- `.github/copilot-instructions.md` — このファイルを読んだら開発規約も必ず確認する旨を追記しています。

運用

- 新しくプロジェクトに参加する開発者はこのドキュメントを最初に読むこと。
- 規約の改善案があれば PR を作成してください（ドキュメント自体も同じプロセスで変更します）。
